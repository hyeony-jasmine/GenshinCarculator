/* ===== Theme ===== */
:root{
  --bg:#0f1724; --card:#0b1220; --muted:#9aa6b2; --text:#e6eef6;
  --accent:#4fd1c5; --accent-2:#7c3aed; --danger:#ff6b6b;
  --glass:rgba(255,255,255,.04); --radius-lg:14px; --radius-md:10px;
  --shadow:0 6px 18px rgba(2,6,23,.6); --gap:16px; --max-width:1100px;
  --tr:180ms cubic-bezier(.2,.9,.3,1); --sum-icon:28px;
  font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
}

/* ===== Base ===== */
*{box-sizing:border-box}
html,body,#root{height:100%}
body{
  margin:0; padding:32px; color:var(--text);
  background:linear-gradient(180deg,var(--bg),#07101a 60%) fixed;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  display:flex; align-items:center; justify-content:center;
}
.app{width:100%; max-width:var(--max-width); display:grid; grid-template-columns:1fr 340px; gap:24px; align-items:start;}
.app-header{grid-column:1/-1; display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:6px;}
.app-title{font-size:20px; font-weight:700; letter-spacing:-.2px}
.header-actions{display:flex; gap:8px; align-items:center;}
.card-list{
  display:flex; flex-direction:column; gap:var(--gap); padding:12px;
  border-radius:var(--radius-lg); box-shadow:var(--shadow);
}

/* ===== Card ===== */
.character-card{
  display:grid; grid-template-columns:96px 1fr auto; gap:12px; align-items:center;
  padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.03);
  transition:transform var(--tr), box-shadow var(--tr);
}
.character-card:hover{transform:translateY(-4px); box-shadow:0 10px 30px rgba(2,6,23,.65);}
.character-img{width:96px;height:96px;border-radius:12px;overflow:hidden;background:var(--glass);display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.character-img img{width:100%;height:100%;object-fit:cover;display:block;}
.character-info{display:flex;flex-direction:column;gap:6px;min-width:0;}
.name-row{display:flex;align-items:center;gap:8px;}
.char-name{font-weight:700;font-size:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.char-sub{font-size:13px;color:var(--muted);}

/* 필드: 항상 좌/우 동일폭(2열 그리드) */
.fields{display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1fr);gap:12px;}
.field{display:flex;flex-direction:column;min-width:0;width:100%;}
.field label{font-size:12px;color:var(--muted);margin-bottom:6px;min-height:16px;line-height:1.2;}
.field .value,.field input,.field select{
  height:36px;border-radius:8px;padding:6px 10px;border:1px solid rgba(255,255,255,.04);
  background:rgba(255,255,255,.02);color:var(--text);font-size:14px;outline:none;
  transition:box-shadow var(--tr), transform var(--tr); width:100%;
}
.field input[type=number]::-webkit-inner-spin-button,
.field input[type=number]::-webkit-outer-spin-button{appearance:auto;}

.card-controls{display:flex;flex-direction:column;gap:8px;align-items:flex-end;justify-content:center;}
.cost-preview{font-weight:700;font-size:14px;color:var(--accent);background:linear-gradient(90deg,rgba(79,209,197,.08),rgba(124,58,237,.04));padding:6px 10px;border-radius:8px;border:1px solid rgba(79,209,197,.12);min-width:88px;text-align:center;}

/* Buttons */
.card-actions{display:flex;gap:6px;}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:8px 12px;font-size:13px;border-radius:10px;cursor:pointer;border:none;transition:transform var(--tr),box-shadow var(--tr);background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));color:var(--text);}
.btn:hover{transform:translateY(-3px);box-shadow:0 8px 18px rgba(2,6,23,.45);}
.btn:active{transform:translateY(-1px);}
.btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#012122;font-weight:700;box-shadow:0 8px 22px rgba(124,58,237,.12);}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,.04);color:var(--muted);}
.btn-danger{background:linear-gradient(90deg,#ff7b7b,#ff5a5a);color:#2b0f0f;font-weight:700;}

/* Empty */
.empty-state{padding:28px;border-radius:12px;text-align:center;color:var(--muted);}

/* ===== Totals ===== */
.total-panel{padding:18px;border-radius:var(--radius-md);border:1px solid rgba(255,255,255,.03);height:fit-content;min-width:240px;position:sticky;top:32px;}
.total-panel h3{margin:0 0 10px;font-size:15px;}
.total-row{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:10px 0;border-bottom:1px dashed rgba(255,255,255,.02);color:var(--muted);}
.total-row:last-child{border-bottom:none;}
.total-value{font-weight:800;color:var(--accent);font-size:18px;}
/* 아이콘 28px & 수직정렬 */
.total-panel .total-row>span:first-child{display:inline-flex;align-items:center;gap:10px;line-height:var(--sum-icon);}
.total-panel .total-row img{width:var(--sum-icon)!important;height:var(--sum-icon)!important;margin-right:8px;vertical-align:middle;}
.total-panel .total-value{line-height:var(--sum-icon);}

/* ===== Small helpers ===== */
.field .value:focus,.field input:focus,.field select:focus{box-shadow:0 6px 18px rgba(124,58,237,.12);border-color:rgba(124,58,237,.45);}
.kv{display:flex;gap:6px;align-items:center;font-size:13px;}
.kv .label{color:var(--muted);font-size:12px;}
.kv .val{font-weight:700;}
:focus{outline:none}
:focus-visible{outline:3px solid rgba(79,209,197,.18);outline-offset:2px;border-radius:8px}

/* ===== Tweaks ===== */
/* 메인 시리즈 아이콘 숨김(텍스트 겹침 방지) */
.character-card .name-row [data-field="element"]>img{display:none;}
/* 상단 3개(가르침/인도/철학), 합계 패널 아이콘 크기 */
.character-card .name-row>div img,
.total-panel .total-row img{width:28px!important;height:28px!important}

/* 헤더 버튼 텍스트 줄바꿈 방지/정렬 */
.header-actions .btn{white-space:nowrap;display:inline-flex;align-items:center;justify-content:center;line-height:1;height:44px;padding:10px 16px;}
.header-actions input,.header-actions select{height:44px}

/* ===== Visual band(색 띠) 방지: 배경 단색 + 합성 보정 ===== */
.card-list,.character-card,.total-panel{
  background:rgba(255,255,255,.03) !important; background-image:none !important;
  -webkit-transform:translateZ(0); backface-visibility:hidden; background-clip:padding-box;
}

/* ===== Responsive ===== */
@media (max-width:980px){
  .app{grid-template-columns:1fr; padding:12px;}
  .total-panel{order:3;margin-top:6px;position:relative;top:auto}
  .app-header{margin-bottom:12px;flex-direction:column;align-items:stretch;gap:12px}
  .character-card{grid-template-columns:84px 1fr;grid-template-rows:auto auto}
  .card-controls{grid-column:1/-1;flex-direction:row;justify-content:space-between;width:100%;margin-top:8px}
  .character-info{min-width:0;width:100%}
}
@media (max-width:720px){
  .app-header{flex-wrap:wrap}
  .header-actions{flex-wrap:wrap;width:100%;gap:8px}
  .header-actions>*:first-child{flex:1 1 100%}
  .header-actions .btn{min-width:120px;flex:0 1 auto}
}
@media (max-width:520px){
  .character-card{grid-template-columns:72px 1fr}
  .character-img{width:72px;height:72px}
  .fields{grid-template-columns:1fr !important;gap:10px}
  .field label{white-space:normal}
  .name-row [data-field="element"] img,.name-row [data-field="element"] .char-sub{display:none}
}
/* === Fields: 데스크톱 4×2, 모바일 2×4, 초소형 1×8 === */

/* 기본: 4칸(가로 4 × 세로 2) */
.character-card{ overflow:hidden; }                      /* 카드 밖으로 삐져나오는 것 방지 */
.character-info{ min-width:0; width:100%; }              /* iOS 줄이기 허용 */
.character-card .fields{
  display:grid !important;
  grid-template-columns: repeat(4, minmax(0,1fr));       /* 4칸 = 같은 폭 */
  grid-auto-rows:minmax(0,auto);
  gap:12px;
  width:100%;
  align-items:start;
}
.character-card .fields .field{ min-width:0; width:100%; }
.character-card .field select,
.character-card .field input{
  display:block;
  width:100%;
  max-width:100%;
  min-width:0;                                           /* iOS 폭 고정 방지 */
  height:36px;
  padding:6px 10px;
  font-size:14px;
  box-sizing:border-box;
}

/* 카드 우측의 미리보기/삭제는 좁아지면 아래 줄로 내려서 겹침 방지 */
@media (max-width: 980px){
  .character-card{ grid-template-columns:84px minmax(0,1fr); grid-template-rows:auto auto; }
  .character-card .card-controls{ grid-column:1 / -1; width:100%; margin-top:8px;
    display:flex; gap:8px; justify-content:space-between; align-items:center; }
}

/* 태블릿/폰: 2칸(가로 2 × 세로 4) */
@media (max-width: 860px){
  .character-card .fields{
    grid-template-columns: repeat(2, minmax(0,1fr));
    gap:10px;
  }
  .character-card .field select,
  .character-card .field input{
    padding: clamp(6px, 1.6vw, 10px) clamp(8px, 2vw, 12px);
    font-size: clamp(12px, 3.4vw, 14px);
  }
}
/* === 강제 2열: 아주 좁아도 2×4 유지 === */
@media (max-width: 860px){
  .character-card .fields{
    grid-template-columns: repeat(2, minmax(120px, 1fr)) !important; /* 두 칸 고정 */
    gap: 8px 8px;
  }

  /* 카드 좌측 아바타를 더 줄여서 폭 확보 */
  .character-card{ grid-template-columns: 64px minmax(0,1fr); }
  .character-img{ width:64px; height:64px; }
  
  /* 컨트롤도 작아지도록 */
  .field label{ font-size: 12px; line-height: 1.2; }
  .field select,
  .field input{
    height: 32px;
    padding: 4px 8px;
    font-size: 13px;
    width: 100%;
    min-width: 0;   /* iOS 폭 고정 방지 */
  }
}

/* 초소형에서도 1열로 바꾸지 않도록 기존 1열 규칙 무력화 */
@media (max-width: 520px){
  .character-card .fields{
    grid-template-columns: repeat(2, minmax(120px, 1fr)) !important;
  }
}

/* === 모든 '현재/목표' 드롭다운 컴팩트화 + 우측 여유로 잘림 방지 === */
.character-card .fields select[data-field],
.character-card .fields input[data-field]{
  display:block;
  width: calc(100% - 8px);   /* 칸보다 살짝 좁게 → 우측 여유 */
  margin-right: 8px;
  min-width: 0;              /* iOS 폭 고정 방지 */
  height: 30px;              /* ↓ 전체적으로 낮춤 */
  padding: 3px 8px;          /* ↓ 패딩 축소 */
  font-size: 12.5px;         /* ↓ 폰트 축소 */
  border-radius: 8px;
  box-sizing: border-box;
}

/* 태블릿/폰에선 한 단계 더 작게 */
@media (max-width: 860px){
  .character-card .fields select[data-field],
  .character-card .fields input[data-field]{
    width: calc(100% - 10px);
    margin-right: 10px;
    height: 28px;
    padding: 2px 7px;
    font-size: 12px;
  }
}

/* 라벨-컨트롤 간격도 조금 줄이기 */
.character-card .fields .field label{
  margin-bottom: 4px;
  font-size: 12px;
}
/* 이름을 최우선으로 보이게 */
.character-card .name-row{
  display:flex; align-items:center; gap:8px; flex-wrap:nowrap;
  min-width:0;
}
.character-card [data-field="name"]{
  flex:1 1 auto; min-width:0;      /* 줄어들 수 있게 */
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
/* 원소 텍스트/배지, 작은 책 아이콘들은 보조 */
.character-card [data-field="element"]{ flex:0 0 auto; }
@media (max-width: 680px){
  .character-card [data-field="element"]{ display:none; }     /* Pyro 등 숨김 */
  .character-card .name-row > div{ display:none; }            /* 가르침/인도/철학 아이콘 숨김 */
}
/* 컨트롤 최대 가로폭 제한(해상도에 맞게 축소) */
:root{ --ctrl-max: clamp(120px, 40vw, 190px); } /* 최소 120px ~ 최대 190px */

.character-card .fields{ justify-items: start; } /* 칸 안에서 좌측 정렬 */
.character-card .field select,
.character-card .field input{
  width: min(100%, var(--ctrl-max));   /* 칸보다 작게 */
  max-width: var(--ctrl-max);
  min-width: 0;                         /* iOS 폭 고정 방지 */
}

/* 모바일에서 한 단계 더 줄이기 */
@media (max-width: 860px){
  :root{ --ctrl-max: clamp(120px, 44vw, 170px); }
}
/* 이름은 항상 보이게(아이콘보다 우선) */
.character-card .name-row{
  display:flex; align-items:center; gap:8px; min-width:0;
}
.character-card [data-field="name"]{
  flex:1 1 auto; min-width:0;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.character-card [data-field="element"]{ flex:0 0 auto; }        /* Pyro 등 텍스트 */

/* 책 아이콘 묶음(가르침/인도/철학) – 점진적 숨김 */
.character-card .name-row > div{ flex:0 0 auto; display:inline-flex; gap:6px; }

/* 먼저 크기 조금 줄이고… */
@media (max-width: 940px){
  .character-card .name-row > div img{ width:22px !important; height:22px !important; }
}

/* 더 좁아지면 ‘철학’(마지막)부터 숨김 */
@media (max-width: 860px){
  .character-card .name-row > div img:nth-last-child(1){ display:none !important; } /* 철학 */
}

/* 더 좁으면 ‘인도’까지 숨김  */
@media (max-width: 780px){
  .character-card .name-row > div img:nth-last-child(2){ display:none !important; } /* 인도 */
}

/* 아주 좁으면 책 아이콘 전부 숨김(이름만 남김) */
@media (max-width: 720px){
  .character-card .name-row > div img{ display:none !important; }
  /* 필요하면 원소 텍스트도 감추고 싶을 때: 아래 주석 해제
  .character-card [data-field="element"]{ display:none !important; }
  */
}

